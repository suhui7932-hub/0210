/* ==========================================================================
   1. 전역 스타일 및 기본 레이아웃 (공통)
   ========================================================================== */
body { 
    margin: 0; padding: 0; background: #1a1a1b; overflow: hidden; 
    font-family: 'Noto Sans KR', sans-serif; user-select: none; color: #e2e2e2; 
}

#main-container { 
    display: flex; flex-direction: column; 
    width: 100vw; height: 100vh; 
}

#book-viewport { 
    flex: 1; position: relative; display: flex; 
    justify-content: center; align-items: center; 
    background: #121213; overflow: hidden; 
}

/* ==========================================================================
   2. 플립북(Turn.js) 코어 스타일
   ========================================================================== */
#book {
    margin: 0 auto !important; display: block !important; visibility: visible !important;
    touch-action: none; -webkit-user-drag: none; user-select: none;
    will-change: transform; transform-origin: center center;
    image-rendering: -webkit-optimize-contrast;
}

#book:not(.zoomed) { cursor: grab; }
#book:active { cursor: grabbing; }

#book img { 
    -webkit-user-drag: none; user-select: none; 
    -webkit-tap-highlight-color: rgba(0,0,0,0); 
}

#book .page { touch-action: none; background-color: #fff; width: 100%; height: 100%; }
.page img { pointer-events: none; }

/* ==========================================================================
   3. PC 전용 UI 구성 요소 (1024px 이상 적용)
   ========================================================================== */
#ui-footer { 
    height: calc(65px + env(safe-area-inset-bottom)); 
    background: #1c1c1e; display: flex; justify-content: space-between; align-items: center; 
    padding: 0 20px env(safe-area-inset-bottom) 20px; border-top: 1px solid #333; z-index: 2000;
}

/* 모바일 전용 상단 바 (PC 기본 숨김) */
#mobile-header {
    display: none; position: fixed; top: 0; left: 0; right: 0;
    height: 54px; background: rgba(28, 28, 30, 0.85); backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px); z-index: 5000; justify-content: flex-end; 
    align-items: center; padding: 0 15px; gap: 15px; opacity: 0;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
    transform: translateY(-100%);
}

.ui-group, .footer-utils { display: flex; align-items: center; gap: 8px; }

/* 버튼 기본 스타일 */
button { 
    -webkit-appearance: none; appearance: none; margin: 0; line-height: 1;
    display: inline-flex; align-items: center; justify-content: center;
    height: 36px; padding: 0 14px; box-sizing: border-box;
    font-family: 'Noto Sans KR', sans-serif; font-size: 13px; font-weight: 500;
    color: #fff; background: #2c2c2e; border: 1px solid #3a3a3c; border-radius: 6px;
    cursor: pointer; transition: all 0.2s ease-in-out; transform: translateZ(0);
}
button:hover { background: #00bcd4; border-color: #00bcd4; color: #000; }
.util-btn { width: 36px; min-width: 36px; padding: 0; }

/* 페이지 점프 및 슬라이더 */
.page-jump-box { display: flex; align-items: center; background: #2c2c2e; border: 1px solid #3a3a3c; border-radius: 6px; padding: 0 8px; height: 32px; }
#page-input { width: 35px !important; background: transparent; border: none; color: #fff; text-align: center; font-size: 13px; outline: none; }
#page-label-spread { font-size: 13px; min-width: 70px; text-align: center; color: #888; }

.slider-container { position: relative; width: 50%; margin: 0 15px; }
#page-slider { width: 100%; -webkit-appearance: none; background: transparent; height: 20px; outline: none; }
#page-slider::-webkit-slider-runnable-track { width: 100%; height: 2px; background: #444; border-radius: 1px; }
#page-slider::-webkit-slider-thumb { 
    -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; 
    background: #00bcd4; margin-top: -6px; border: 2px solid #1c1c1e; box-shadow: 0 0 5px rgba(0,188,212,0.5); 
}

#slider-tooltip {
    position: absolute; top: -40px; transform: translateX(-50%);
    background: #3b82f6; color: #000; padding: 4px 10px; border-radius: 4px;
    font-size: 12px; font-weight: bold; white-space: nowrap;
    opacity: 0; transition: opacity 0.3s ease, left 0.1s ease-out; z-index: 3000;
}
#slider-tooltip.show { opacity: 1; }
#slider-tooltip::after { content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); border: 5px solid transparent; border-top-color: #3b82f6; }

/* ==========================================================================
   4. 목차(Thumbnail) 및 모달 패널
   ========================================================================== */
#thumb-panel {
    position: fixed; bottom: -280px; left: 0; width: 100%; height: 130px;
    background: rgba(15, 15, 17, 0.95); backdrop-filter: blur(15px);
    transition: bottom 0.4s cubic-bezier(0.1, 0.7, 0.1, 1); z-index: 5000; display: flex; flex-direction: column;
}
#thumb-panel.open { bottom: calc(65px + env(safe-area-inset-bottom)) !important; }

#thumb-track { flex: 1; display: flex; flex-wrap: nowrap; align-items: center; padding: 20px 40px; gap: 15px; overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
#thumb-scroll-container { position: absolute; bottom: 10px; left: 40px; right: 40px; height: 4px; background: rgba(255, 255, 255, 0.1); border-radius: 2px; }
#thumb-scrollbar { position: absolute; top: -3px; width: 50px; height: 10px; background: #00bcd4; border-radius: 5px; cursor: grab; z-index: 10000; }
#thumb-scrollbar.dragging { background: #fff !important; transform: scaleY(1.5); }

.thumb-item { flex: 0 0 calc(10% - 15px); min-width: 50px; cursor: pointer; text-align: center; }
.thumb-img-container { position: relative; border-radius: 4px; overflow: hidden; border: 2px solid #333; height: 80px; }
.thumb-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 16px; font-weight: bold; text-shadow: 0 0 10px rgba(0,0,0,0.8); }
.thumb-item img { width: 100%; height: 160px; display: block; filter: brightness(0.8); object-fit: cover; object-position: top; }
.thumb-item.active .thumb-img-container { border-color: #00bcd4; box-shadow: 0 0 15px rgba(0, 188, 212, 0.5); }

.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 9000; justify-content: center; align-items: center; }
.modal-overlay.open { display: flex; }
.modal-content { background: #2c2c2e; padding: 30px; border-radius: 12px; max-width: 90%; color: #fff; }

#loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; color: #00bcd4; }
.spinner { width: 30px; height: 30px; border: 3px solid rgba(0,188,212, 0.2); border-top: 3px solid #00bcd4; border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 10px; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* ==========================================================================
   5. 모바일 최적화 (Max-width: 1023px)
   ========================================================================== */
@media (max-width: 1023px) {
    /* [1] 상단 바 활성화 */
    #mobile-header { 
        display: flex !important; 
        visibility: visible !important;
    }

    /* [2] 하단 푸터: 슬라이더 제거 및 세련된 레이아웃 */
    #ui-footer.mobile-ui {
        display: flex !important;
        position: fixed; bottom: 0; left: 0; right: 0;
        height: 70px !important; 
        background: rgba(30, 30, 32, 0.85); backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 0 20px env(safe-area-inset-bottom) 20px !important;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
        transform: translateY(100%); opacity: 0;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        justify-content: center; align-items: center;
    }

    /* 터치 토글 상태 (상/하단 동시 적용) */
    .mobile-ui.active { transform: translateY(0) !important; opacity: 1 !important; }

    /* [3] 모바일에서 숨길 PC 전용 항목 */
    .slider-container, #page-slider, #slider-tooltip,
    #btnDisplayMode, .mobile-hide, #ui-footer .divider, #page-label-spread,
    #ui-footer .footer-utils, .primary-btn span { 
        display: none !important; 
    }

    /* [4] 모바일 버튼 그룹 배치 (이전, 다음, 도움말, 목차) */
    .main-controls {
        display: flex !important;
        width: 100% !important;
        justify-content: space-between !important;
        align-items: center !important;
        gap: 0 !important;
    }

    /* [5] 세련된 아이콘 버튼 스타일 (투박함 제거) */
    #ui-footer.mobile-ui button, 
    #mobile-header button,
    .m-icon-btn { 
        flex: none !important;
        width: 46px !important;
        height: 46px !important;
        background: rgba(255, 255, 255, 0.08) !important;
        border: none !important;
        border-radius: 14px !important; /* 부드러운 라운딩 */
        font-size: 18px !important;
        color: #ffffff !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
        padding: 0 !important;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    /* 버튼 터치 피드백 */
    #ui-footer.mobile-ui button:active {
        background: rgba(0, 188, 212, 0.4) !important;
        transform: scale(0.95);
    }

    /* 목차 버튼 전용 (아이콘화 보강) */
    #thumb-toggle {
        font-size: 0 !important; text-indent: -9999px !important; 
        overflow: hidden !important; position: relative;
    }
    #thumb-toggle::before {
        content: '▤'; font-size: 22px; color: #fff; position: absolute;
        top: 50%; left: 50%; transform: translate(-50%, -50%); text-indent: 0;
    }

    /* [6] 목차 패널 위치 조정 */
    #thumb-panel { 
        height: 160px !important; 
        background: rgba(20, 20, 22, 0.95);
        border-radius: 20px 20px 0 0;
        bottom: -200px !important; 
    }
    #thumb-panel.open { 
        bottom: calc(70px + env(safe-area-inset-bottom)) !important; 
    }
}

/* ==========================================================================
   6. 터치 및 방어 코드 (공통)
   ========================================================================== */
#ui-footer, #ui-footer *, #thumb-toggle, #thumb-panel, #help-modal, .modal-content {
    touch-action: manipulation !important;
    -webkit-user-select: none; user-select: none;
    -webkit-tap-highlight-color: transparent;
}